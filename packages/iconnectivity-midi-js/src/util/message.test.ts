import { test, expect } from "vitest";
import { buildMessage, isValidMessage } from "./message";

// Message to get all devices
const testMsg = [
  0xf0, 0x00, 0x01, 0x73, 0x7d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x40, 0x01, 0x00, 0x00, 0x3e, 0xf7,
];

test("buildMessage should correctly calculate the checksum", () => {
  const msg = buildMessage([
    ...[0x00, 0x00],
    ...[0x00, 0x00, 0x00, 0x00, 0x00],
    ...[0x00, 0x00],
    ...[0x40, 0x01],
    ...[0x00, 0x00],
  ]);

  expect(msg).toEqual([
    ...[0xf0, 0x00, 0x01, 0x73, 0x7d],
    ...[0x00, 0x00],
    ...[0x00, 0x00, 0x00, 0x00, 0x00],
    ...[0x00, 0x00],
    ...[0x40, 0x01],
    ...[0x00, 0x00],
    0x3f,
    0xf7,
  ]);

  const msg2 = buildMessage([
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x01, 0x00,
    0x00,
  ]);

  expect(msg2).toEqual(testMsg);
});

test("isValidMessage should correctly identify valid messages", () => {
  expect(isValidMessage(testMsg)).toBe(true);
});
